import{d as T,h as v,i as j,j as F,k as L,E as r,g as M,l as g,f as y,o as i,a as t,e as d,w as a,r as n,F as R,m as O,c as b,n as h,b as m,t as p,_ as q}from"./index-DZrbIBqR.js";const G={class:"user-list"},H={class:"user-cell"},J={class:"user-cell"},K={class:"user-cell"},P={class:"user-cell"},Q={class:"user-cell"},W=T({__name:"Users",setup(X){const _=v([]),u=v(!1),e=j({username:"",phone:"",password:"",role:"user"}),x=v(localStorage.getItem("role")||""),U=M(),f=F(()=>x.value==="admin");L(()=>{f.value?V():(r.warning("无权限访问用户管理页"),U.push("/"))});async function V(){try{const l=await g.get("/users");_.value=l.data.map(o=>({...o,password:void 0,created_at:o.created_at||null}))||[]}catch(l){r.error("获取用户列表失败"),console.error(l)}}function S(){e.username="",e.phone="",e.password="",e.role="user",u.value=!0}function B(l){e.username="",e.phone="",e.password="",e.role="user",l()}async function I(){if(!e.username||!e.password){r.warning("用户名和密码不能为空");return}try{const l={username:e.username,phone:e.phone,password:e.password,is_admin:e.role==="admin"};await g.post("/users/add",l,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}),r.success("用户添加成功"),u.value=!1,_.value.unshift({email:e.username,is_admin:e.role==="admin",created_at:new Date().toISOString(),password:e.password}),e.username="",e.password="",e.role="user"}catch(l){r.error("添加用户失败"),console.error(l)}}async function $(l){try{await g.delete(`/users/${encodeURIComponent(l)}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}),r.success("删除成功"),V()}catch(o){r.error("删除用户失败"),console.error(o)}}return(l,o)=>{const c=n("el-button"),N=n("el-col"),z=n("el-row"),k=n("el-input"),w=n("el-form-item"),C=n("el-option"),A=n("el-select"),D=n("el-form"),E=n("el-dialog");return i(),y("div",null,[t(z,{justify:"end",style:{"margin-bottom":"12px"}},{default:a(()=>[t(N,null,{default:a(()=>[f.value?(i(),b(c,{key:0,type:"primary",onClick:S},{default:a(()=>[...o[5]||(o[5]=[m("新增用户",-1)])]),_:1})):h("",!0)]),_:1})]),_:1}),d("div",G,[(i(!0),y(R,null,O(_.value,s=>(i(),y("div",{class:"user-row",key:s.email},[d("div",H,p(s.email),1),d("div",J,p(s.is_admin?"管理员":"普通用户"),1),d("div",K,p(s.password||"******"),1),d("div",P,p(s.created_at?new Date(s.created_at).toLocaleString():"-"),1),d("div",Q,[f.value&&!s.is_admin?(i(),b(c,{key:0,type:"danger",size:"small",onClick:Y=>$(s.email)},{default:a(()=>[...o[6]||(o[6]=[m(" 删除 ",-1)])]),_:1},8,["onClick"])):h("",!0)])]))),128))]),t(E,{modelValue:u.value,"onUpdate:modelValue":o[4]||(o[4]=s=>u.value=s),width:"400px","before-close":B},{title:a(()=>[...o[7]||(o[7]=[m("新增用户",-1)])]),footer:a(()=>[t(c,{onClick:o[3]||(o[3]=s=>u.value=!1)},{default:a(()=>[...o[8]||(o[8]=[m("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:I},{default:a(()=>[...o[9]||(o[9]=[m("提交",-1)])]),_:1})]),default:a(()=>[t(D,{model:e,"label-width":"80px"},{default:a(()=>[t(w,{label:"用户名"},{default:a(()=>[t(k,{modelValue:e.username,"onUpdate:modelValue":o[0]||(o[0]=s=>e.username=s),autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(w,{label:"密码"},{default:a(()=>[t(k,{type:"password",modelValue:e.password,"onUpdate:modelValue":o[1]||(o[1]=s=>e.password=s),autocomplete:"new-password"},null,8,["modelValue"])]),_:1}),t(w,{label:"角色"},{default:a(()=>[t(A,{modelValue:e.role,"onUpdate:modelValue":o[2]||(o[2]=s=>e.role=s),placeholder:"请选择角色"},{default:a(()=>[t(C,{label:"普通用户",value:"user"}),t(C,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),ee=q(W,[["__scopeId","data-v-33888f4a"]]);export{ee as default};
